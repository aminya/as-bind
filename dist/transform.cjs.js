"use strict";class e{}function t(e){return e.internalName.startsWith("~")}function n(e,t){return 0!=(e.flags&t)}function r(e){return e.getClass()?.internalName??e.toString()}function s(e){let t=e.parent;for(;t!==t.parent;)t=t.parent;return t}function a(e){return{returnType:r(e.signature.returnType),parameters:e.signature.parameterTypes.map((e=>r(e)))}}function i(e){const t={},n=e.getClass?.();if(!n)return t;if(t[n.internalName]={id:n.id,byteSize:n.nextMemoryOffset},n.typeArguments)for(const e of n.typeArguments)Object.assign(t,i(e));return t}function o(e){const t={};return Object.assign(t,i(e.signature.returnType)),e.signature.parameterTypes.forEach((e=>Object.assign(t,i(e)))),t}module.exports=class extends e{afterCompile(e){const r=[...this.program.elementsByDeclaration.values()].filter((e=>n(e,1048576))).filter((e=>!t(e))).filter((e=>55===e.declaration.kind)),i=[...this.program.elementsByDeclaration.values()].filter((e=>n(e,4))).filter((e=>!t(e))).filter((e=>55===e.declaration.kind)),c={},l={};for(let e of i){if(!e.instances)continue;if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");const t=e.instances.get("");let n,r,i=t.declaration.decorators;if(i)for(let e of i)"external"===e.name.text&&e.args&&(e.args.length>1?(n=e.args[0].value,r=e.args[1].value):r=e.args[0].value);const u=n||s(t).internalName.split("/").slice(-1)[0];l.hasOwnProperty(u)||(l[u]={});let f=t.name;r?f=r:t.parent&&12===t.parent.kind&&(f=t.parent.name+"."+t.name),l[u][f]=a(t),Object.assign(c,o(t))}const u={};for(let e of r){if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");const t=e.instances.get("");u[t.name]=a(t),Object.assign(c,o(t))}e.addCustomSection("as-bind_bindings",new TextEncoder("utf8").encode(JSON.stringify({typeIds:c,importedFunctions:l,exportedFunctions:u})))}};
//# sourceMappingURL=transform.cjs.js.map
